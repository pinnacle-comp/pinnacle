[workspace]
members = ["pinnacle-api-defs", "api/rust", "api/rust/pinnacle-api-macros"]

[workspace.package]
authors = ["Ottatop <ottatop1227@gmail.com>"]
edition = "2021"
repository = "https://github.com/pinnacle-comp/pinnacle/"

[workspace.dependencies]
tokio = { version = "1.36.0", features = ["macros", "rt-multi-thread"]}
tokio-stream = { version = "0.1.14", features = ["net"] }

prost = "0.12.3"
tonic = "0.11.0"
tonic-reflection = "0.11.0"
tonic-build = "0.11.0"

pinnacle-api-defs = { path = "./pinnacle-api-defs" }

xkbcommon = "0.7.0"
xdg = "2.5.2"

#################################################################################

[package]
name = "pinnacle"
version = "0.0.1"
authors.workspace = true
edition.workspace = true
license = "GPL-3.0+"
description = "A WIP Smithay-based Wayland compositor, inspired by AwesomeWM"
readme = "README.md"
repository.workspace = true
keywords = ["wayland", "compositor", "smithay", "lua"]

[dependencies]
smithay = { git = "https://github.com/Smithay/smithay", rev = "b62ced7", default-features = false, features = ["desktop", "wayland_frontend"] }
smithay-drm-extras = { git = "https://github.com/Smithay/smithay", rev = "b62ced7" }

tracing = "0.1.40"
tracing-subscriber = { version = "0.3.18", features = ["env-filter", "registry"] }
tracing-appender = "0.2.3"

anyhow = { version = "1.0.79", features = ["backtrace"] }
thiserror = "1.0.57"

xcursor = { version = "0.3.5" }
image = { version = "0.24.8", default-features = false }

serde = { version = "1.0.196", features = ["derive"] }
toml = "0.8.10"
shellexpand = "3.1.0"
clap = { version = "4.5.1", features = ["derive"] }
x11rb = { version = "0.13.0", default-features = false, features = ["composite"] }
xkbcommon = { workspace = true }
xdg = { workspace = true }
sysinfo = "0.30.5"
nix = { version = "0.27.1", features = ["user", "resource"] }

prost = { workspace = true }
tonic = { workspace = true }
tonic-reflection = { workspace = true }

tokio = { workspace = true, features = ["process", "io-util", "signal"] }
tokio-stream = { workspace = true }

bitflags = "2.4.2"
pinnacle-api-defs = { workspace = true }

[build-dependencies]
xdg = { workspace = true }

[dev-dependencies]
temp-env = "0.3.6"
tempfile = "3.10.0"

[features]
default = [
    # udev
    "smithay/backend_libinput",
    "smithay/backend_udev",
    "smithay/backend_drm",
    "smithay/backend_gbm",
    "smithay/backend_vulkan",
    "smithay/backend_egl",
    "smithay/backend_session_libseat",
    "smithay/renderer_gl",
    "smithay/renderer_multi",
    # egl
    "smithay/use_system_lib",
    "smithay/backend_egl",
    # winit
    "smithay/backend_winit",
    "smithay/backend_drm",
    # xwayland
    "smithay/xwayland",
    "smithay/x11rb_event_source"
]
