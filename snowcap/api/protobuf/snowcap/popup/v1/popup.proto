syntax = "proto3";

package snowcap.popup.v1;

import "google/protobuf/empty.proto";
import "snowcap/widget/v1/widget.proto";
import "snowcap/operation/v1/operation.proto";

enum Anchor {
  ANCHOR_UNSPECIFIED = 0;
  ANCHOR_TOP = 1;
  ANCHOR_BOTTOM = 2;
  ANCHOR_LEFT = 3;
  ANCHOR_RIGHT = 4;
  ANCHOR_TOP_LEFT = 5;
  ANCHOR_TOP_RIGHT = 6;
  ANCHOR_BOTTOM_LEFT = 7;
  ANCHOR_BOTTOM_RIGHT = 8;
  ANCHOR_NONE = 9;
}

enum Gravity {
  GRAVITY_UNSPECIFIED = 0;
  GRAVITY_TOP = 1;
  GRAVITY_BOTTOM = 2;
  GRAVITY_LEFT = 3;
  GRAVITY_RIGHT = 4;
  GRAVITY_TOP_LEFT = 5;
  GRAVITY_TOP_RIGHT = 6;
  GRAVITY_BOTTOM_LEFT = 7;
  GRAVITY_BOTTOM_RIGHT = 8;
  GRAVITY_NONE = 9;
}

message Offset {
  float x = 1;
  float y = 2;
}

message Rectangle {
  float x = 1;
  float y = 2;
  float width = 3;
  float height = 4;
}

message ConstraintsAdjust {
  bool none = 1;
  bool slide_x = 2;
  bool slide_y = 3;
  bool flip_x = 4;
  bool flip_y = 5;
  bool resize_x = 6;
  bool resize_y = 7;
}

message Position {
  oneof strategy {
    google.protobuf.Empty at_cursor = 1;
    Rectangle absolute = 2;
    string at_widget = 3;
  }
}

message NewPopupRequest {
  snowcap.widget.v1.WidgetDef widget_def = 1;
  oneof parent_id {
    uint32 layer_id = 2;
    uint32 deco_id = 3;
    uint32 popup_id = 4;
  }
  Position position = 5;
  Anchor anchor = 6;
  Gravity gravity = 7;
  Offset offset = 8;
  ConstraintsAdjust constraints_adjust = 9;
  bool no_grab = 10;
  bool no_replace = 11;
}

message NewPopupResponse {
  uint32 popup_id = 1;
}

message CloseRequest {
  uint32 popup_id = 1;
}

message OperatePopupRequest {
  uint32 popup_id = 1;
  snowcap.operation.v1.Operation operation = 2;
}
message OperatePopupResponse {}

message UpdatePopupRequest {
  uint32 popup_id = 1;
  optional snowcap.widget.v1.WidgetDef widget_def = 2;
  optional Position position = 5;
  optional Anchor anchor = 6;
  optional Gravity gravity = 7;
  optional Offset offset = 8;
  optional ConstraintsAdjust constraints_adjust = 9;
}
message UpdatePopupResponse {}

message ViewRequest {
  uint32 popup_id = 1;
}
message ViewResponse {}

message GetPopupEventsRequest {
  uint32 popup_id = 1;
}

message PopupEvent {
  enum Focus {
    FOCUS_UNSPECIFIED = 0;
    FOCUS_GAINED = 1;
    FOCUS_LOST = 2;
  }

  oneof event {
    Focus focus = 1;
  }
}

message GetPopupEventsResponse {
  repeated PopupEvent popup_events = 1;
}

service PopupService {
  rpc NewPopup(NewPopupRequest) returns (NewPopupResponse);
  rpc Close(CloseRequest) returns (google.protobuf.Empty);
  rpc OperatePopup(OperatePopupRequest) returns (OperatePopupResponse);
  rpc UpdatePopup(UpdatePopupRequest) returns (UpdatePopupResponse);
  rpc RequestView(ViewRequest) returns (ViewResponse);
  rpc GetPopupEvents(GetPopupEventsRequest) returns (stream GetPopupEventsResponse);
}
